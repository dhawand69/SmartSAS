<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Attendance System</title>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- External CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- LOGIN SCREEN -->
    <div id="loginOverlay" class="login-wrapper">
        <div class="login-card">
            <div class="login-header">
                <h2><i class="fas fa-book"></i> Attendance System</h2>
                <p>Please login to continue</p>
            </div>

            <div class="login-tabs">
                <button class="login-tab active" onclick="switchLoginTab('admin')" data-role="admin" type="button">
                    <i class="fas fa-user-shield"></i> Admin
                </button>
                <button class="login-tab" onclick="switchLoginTab('faculty')" data-role="faculty" type="button">
                    <i class="fas fa-chalkboard-teacher"></i> Faculty
                </button>
                <button class="login-tab" onclick="switchLoginTab('student')" data-role="student" type="button">
                    <i class="fas fa-user-graduate"></i> Student
                </button>
            </div>

            <!-- Admin Login Form -->
            <div id="adminLoginForm" class="login-form active">
                <div class="alert alert-error" id="adminLoginError" style="display: none;"></div>
                <form id="adminLoginFormElement" onsubmit="handleAdminLogin(event); return false;">
                    <div class="form-group">
                        <label for="adminPassword">Admin Password:</label>
                        <input type="password" id="adminPassword" placeholder="Enter password" required
                            autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-sign-in-alt"></i> Login as Admin
                    </button>
                </form>
            </div>

            <!-- Faculty Login Form -->
            <div id="facultyLoginForm" class="login-form">
                <div class="alert alert-error" id="facultyLoginError" style="display: none;"></div>
                <form id="facultyLoginFormElement" onsubmit="handleFacultyLogin(event); return false;">
                    <div class="form-group">
                        <label for="loginFacultyId">Faculty ID:</label>
                        <input type="text" id="loginFacultyId" placeholder="Enter Faculty ID" required>
                    </div>
                    <div class="form-group">
                        <label for="loginFacultyPassword">Password:</label>
                        <input type="password" id="loginFacultyPassword" placeholder="Enter password" required
                            autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-sign-in-alt"></i> Login as Faculty
                    </button>
                </form>
            </div>

            <!-- Student Login Form -->
            <div id="studentLoginForm" class="login-form">
                <div class="alert alert-error" id="studentLoginError" style="display: none;"></div>
                <form id="studentLoginFormElement" onsubmit="handleStudentLogin(event); return false;">
                    <div class="form-group">
                        <label for="loginStudentId">Registration Number (Roll No):</label>
                        <input type="text" id="loginStudentId" placeholder="Enter Reg No (e.g. 22156148040)" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-sign-in-alt"></i> Login as Student
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- MAIN APP CONTAINER -->
    <div class="container" id="mainContainer" style="display: none;">
        <div class="navbar">
            <h1><i class="fas fa-book"></i> Advanced Attendance System</h1>
            <div class="navbar-right">
                <div class="user-info">
                    <div id="loggedInUser" style="font-weight: 600;">Not Logged In</div>
                    <span id="roleBadge" class="user-role-badge">GUEST</span>
                </div>
                <button class="btn btn-info btn-small" onclick="openPasswordChangeModal()" id="passwordChangeBtn"
                    style="display: none;">
                    <i class="fas fa-key"></i> Change Password
                </button>
                <div class="offline-indicator" id="connectionStatus">
                    <i class="fas fa-sync-alt"></i> Connecting...
                </div>
                <button class="btn btn-danger btn-small" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- ADMIN PANEL -->
        <div id="adminPanel" class="panel" style="display: none;">
            <div class="section">
                <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>Total Students</h3>
                        <div class="value" id="totalStudents">0</div>
                    </div>
                    <div class="stat-card success">
                        <h3>Total Faculty</h3>
                        <div class="value" id="totalFaculty">0</div>
                    </div>
                    <div class="stat-card warning">
                        <h3>Total Classes</h3>
                        <div class="value" id="totalClasses">0</div>
                    </div>
                    <div class="stat-card danger">
                        <h3>Active Years</h3>
                        <div class="value" id="activeYears">0</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchAdminTab('users')"><i class="fas fa-users"></i>
                        Students</button>
                    <button class="tab-btn" onclick="switchAdminTab('faculty')"><i
                            class="fas fa-chalkboard-teacher"></i> Faculty</button>
                    <button class="tab-btn" onclick="switchAdminTab('classes')"><i class="fas fa-school"></i>
                        Classes</button>
                    <button class="tab-btn" onclick="switchAdminTab('years')"><i class="fas fa-calendar-alt"></i> Years
                        & Semesters</button>
                    <button class="tab-btn" onclick="switchAdminTab('bulkImport')"><i class="fas fa-file-import"></i>
                        Bulk Import</button>
                    <button class="tab-btn" onclick="switchAdminTab('attendanceHistory')"><i class="fas fa-history"></i>
                        Attendance History</button>
                    <button class="tab-btn" onclick="switchAdminTab('bulkExport')"><i class="fas fa-file-export"></i>
                        Bulk Export</button>
                    <button class="tab-btn" onclick="switchAdminTab('settings')"><i class="fas fa-cog"></i>
                        Settings</button>
                </div>

                <!-- Users Tab -->
                <div id="adminUsers" class="tab-content active">
                    <h2 class="section-title"><i class="fas fa-users"></i> Students</h2>

                    <!-- Filter Dashboard -->
                    <div class="filter-container">
                        <div class="filter-group">
                            <span class="filter-label"><i class="fas fa-graduation-cap"></i> Select Academic
                                Year:</span>
                            <div class="filter-btn-group" id="yearFilterGroup">
                                <button class="filter-btn active" onclick="filterStudents('all')">All</button>
                                <button class="filter-btn" onclick="filterStudents(1)">1st Year</button>
                                <button class="filter-btn" onclick="filterStudents(2)">2nd Year</button>
                                <button class="filter-btn" onclick="filterStudents(3)">3rd Year</button>
                                <button class="filter-btn" onclick="filterStudents(4)">4th Year</button>
                            </div>
                        </div>

                        <div class="filter-group" style="margin-top: 15px;">
                            <span class="filter-label"><i class="fas fa-university"></i> Select Branch:</span>
                            <select id="branchFilterSelect" onchange="filterByBranch(this.value)" class="branch-select">
                                <option value="all">All Branches</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Civil">Civil</option>
                                <option value="Mechanical">Mechanical</option>
                                <option value="Electrical">Electrical</option>
                                <option value="ECE">ECE</option>
                                <option value="CSE(Cyber Security)">CSE(Cyber Security)</option>
                                <option value="CSE(Networks)">CSE(Networks)</option>
                            </select>
                        </div>

                        <div class="filter-group" id="semesterFilterGroup" style="display:none;">
                            <span class="filter-label"><i class="fas fa-calendar"></i> Select Semester:</span>
                            <div class="filter-btn-group" id="semesterButtons">
                                <!-- Dynamic buttons -->
                            </div>
                        </div>

                        <!-- Select All Banner -->
                        <div id="selectAllBanner" class="selection-prompt" style="display:none;">
                            <span id="selectAllText">You have selected 0 students.</span>
                            <button onclick="selectAllListed()">Select all <span id="selectAllCount">0</span> listed
                                students</button>
                        </div>

                        <div id="bulkActionContainer" class="bulk-action-bar" style="display:none;">
                            <div class="bulk-control-group">
                                <strong><i class="fas fa-arrow-up"></i> Increment:</strong>
                                <button class="btn btn-warning" onclick="promoteFilteredStudents()">
                                    +1 Sem <span class="action-target-text">All Listed</span>
                                </button>
                            </div>

                            <div class="divider"></div>

                            <div class="bulk-control-group">
                                <strong><i class="fas fa-calendar-alt"></i> Set Exact Sem:</strong>
                                <select id="bulkSemSelect" class="semester-select">
                                    <option value="1">Sem 1</option>
                                    <option value="2">Sem 2</option>
                                    <option value="3">Sem 3</option>
                                    <option value="4">Sem 4</option>
                                    <option value="5">Sem 5</option>
                                    <option value="6">Sem 6</option>
                                    <option value="7">Sem 7</option>
                                    <option value="8">Sem 8</option>
                                </select>
                                <button class="btn btn-info" onclick="setBulkSemester()">Apply to <span
                                        class="action-target-text">All Listed</span></button>
                            </div>

                            <div class="divider"></div>

                            <div class="bulk-control-group">
                                <strong><i class="fas fa-trash"></i> Actions:</strong>
                                <button class="btn btn-danger" onclick="deleteFilteredStudents()">Delete <span
                                        class="action-target-text">Listed</span></button>
                            </div>
                        </div>
                    </div>

                    <div class="table-header">
                        <h3>Student List <span id="studentCount" class="count-badge">(0)</span></h3>
                        <button class="btn btn-primary" onclick="openModal('addUserModal')">
                            <i class="fas fa-plus"></i> Add Student
                        </button>
                    </div>

                    <div class="table-responsive">
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="masterCheckbox" onclick="toggleSelectAll()"></th>
                                    <th>Roll No</th>
                                    <th>Name</th>
                                    <th>Dept</th>
                                    <th>Year</th>
                                    <th>Sem</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr id="noStudentsRow" style="display: none;">
                                    <td colspan="7" class="no-data">No students found. Add your first student using the
                                        "Add Student" button.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Faculty Tab -->
                <div id="adminFaculty" class="tab-content">
                    <h2 class="section-title"><i class="fas fa-chalkboard-teacher"></i> Faculty Management</h2>

                    <div class="filter-container">
                        <div class="filter-group">
                            <span class="filter-label"><i class="fas fa-university"></i> Filter by Branch:</span>
                            <select id="facultyBranchFilter" onchange="loadFaculty()" class="branch-select">
                                <option value="all">All Departments</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Civil">Civil</option>
                                <option value="Mechanical">Mechanical</option>
                                <option value="Electrical">Electrical</option>
                                <option value="ECE">ECE</option>
                                <option value="CSE(Cyber Security)">CSE(Cyber Security)</option>
                                <option value="CSE(Networks)">CSE(Networks)</option>
                                <option value="Applied Science">Applied Science</option>
                            </select>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="openModal('addFacultyModal')">
                            <i class="fas fa-plus"></i> Add Faculty
                        </button>
                        <button class="btn btn-warning" onclick="openFacultyPasswordResetModal()">
                            <i class="fas fa-key"></i> Reset Faculty Password
                        </button>
                    </div>

                    <div class="table-responsive">
                        <table id="facultyTable">
                            <thead>
                                <tr>
                                    <th>Faculty ID</th>
                                    <th>Name</th>
                                    <th>Assigned Classes</th>
                                    <th>Department</th>
                                    <th>Specialization</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="facultyTableBody">
                                <tr id="noFacultyRow" style="display: none;">
                                    <td colspan="6" class="no-data">No faculty found. Add your first faculty member
                                        using the "Add Faculty" button.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Classes Tab -->
                <div id="adminClasses" class="tab-content">
                    <h2 class="section-title"><i class="fas fa-school"></i> Classes & Subjects</h2>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="openModal('addClassModal')">
                            <i class="fas fa-plus"></i> Add Class
                        </button>
                        <button class="btn btn-success" onclick="openBatchClassModal()">
                            <i class="fas fa-folder-plus"></i> Batch Class Creator
                        </button>
                    </div>

                    <!-- Class Filters -->
                    <div class="filter-container">
                        <div class="filter-group">
                            <span class="filter-label"><i class="fas fa-graduation-cap"></i> Filter by Year:</span>
                            <div class="filter-btn-group" id="classYearFilterGroup">
                                <button class="filter-btn active" onclick="filterClasses('all')">All</button>
                                <button class="filter-btn" onclick="filterClasses(1)">1st Year</button>
                                <button class="filter-btn" onclick="filterClasses(2)">2nd Year</button>
                                <button class="filter-btn" onclick="filterClasses(3)">3rd Year</button>
                                <button class="filter-btn" onclick="filterClasses(4)">4th Year</button>
                            </div>
                        </div>

                        <div class="filter-group" id="classSemesterFilterGroup" style="display:none;">
                            <span class="filter-label"><i class="fas fa-calendar"></i> Filter by Semester:</span>
                            <div class="filter-btn-group" id="classSemesterButtons">
                                <!-- Dynamic buttons -->
                            </div>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table id="classesTable">
                            <thead>
                                <tr>
                                    <th>Class Code</th>
                                    <th>Course Name</th>
                                    <th>Department</th>
                                    <th>Semester</th>
                                    <th>Faculty</th>
                                    <th>Year</th>
                                    <th>Credits</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="classesTableBody">
                                <tr id="noClassesRow" style="display: none;">
                                    <td colspan="8" class="no-data">No classes found. Add your first class using the
                                        "Add Class" button.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Years & Semesters Tab -->
                <div id="adminYears" class="tab-content">
                    <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Years & Semesters</h2>
                    <button class="btn btn-primary" onclick="openModal('addYearModal')">
                        <i class="fas fa-plus"></i> Add Academic Year
                    </button>

                    <div id="yearsContainer" class="years-grid"></div>

                    <h3 class="subsection-title"><i class="fas fa-plus-circle"></i> Add Custom Semester</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customYearInput">Year:</label>
                            <input type="number" id="customYearInput" placeholder="e.g., 2024" min="2000" max="2100">
                        </div>
                        <div class="form-group">
                            <label for="customSemesterInput">Semester Number:</label>
                            <input type="number" id="customSemesterInput" placeholder="e.g., 1-8" min="1" max="8">
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button class="btn btn-success" onclick="addCustomSemester()">
                                <i class="fas fa-plus"></i> Add Semester
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bulk Import Tab -->
                <div id="adminBulkImport" class="tab-content">
                    <h2 class="section-title"><i class="fas fa-file-import"></i> Bulk Import</h2>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Import multiple records at once from CSV files. Download
                        templates below and fill with your data.
                    </div>

                    <div class="template-section">
                        <h3><i class="fas fa-download"></i> Download Templates</h3>
                        <div class="template-buttons">
                            <button class="btn btn-secondary" onclick="downloadTemplate('students')">
                                <i class="fas fa-download"></i> Students Template
                            </button>
                            <button class="btn btn-secondary" onclick="downloadTemplate('faculty')">
                                <i class="fas fa-download"></i> Faculty Template
                            </button>
                            <button class="btn btn-secondary" onclick="downloadTemplate('classes')">
                                <i class="fas fa-download"></i> Classes Template
                            </button>
                            <button class="btn btn-warning" onclick="downloadCompleteDbTemplate()">
                                <i class="fas fa-database"></i> Complete DB Template
                            </button>
                        </div>
                    </div>

                    <!-- Students Import -->
                    <h3><i class="fas fa-users"></i> Import Students (CSV)</h3>
                    <div class="file-upload-area" id="studentUploadArea"
                        onclick="document.getElementById('studentFile').click()">
                        <div class="upload-icon"><i class="fas fa-file-csv"></i></div>
                        <p><strong>Click to upload or drag & drop</strong></p>
                        <p class="upload-hint">CSV file only</p>
                        <input type="file" id="studentFile" accept=".csv" style="display:none;"
                            onchange="handleStudentUpload(event)">
                    </div>
                    <div class="import-progress" id="studentProgress" style="display: none;">
                        <div>Importing students...</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="studentProgressBar" style="width: 0%">0%</div>
                        </div>
                    </div>

                    <!-- Faculty Import -->
                    <h3><i class="fas fa-chalkboard-teacher"></i> Import Faculty (CSV)</h3>
                    <div class="file-upload-area" id="facultyUploadArea"
                        onclick="document.getElementById('facultyFile').click()">
                        <div class="upload-icon"><i class="fas fa-file-csv"></i></div>
                        <p><strong>Click to upload or drag & drop</strong></p>
                        <p class="upload-hint">CSV file only</p>
                        <input type="file" id="facultyFile" accept=".csv" style="display:none;"
                            onchange="handleFacultyUpload(event)">
                    </div>
                    <div class="import-progress" id="facultyProgress" style="display: none;">
                        <div>Importing faculty...</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="facultyProgressBar" style="width: 0%">0%</div>
                        </div>
                    </div>

                    <!-- Classes Import -->
                    <h3><i class="fas fa-school"></i> Import Classes (CSV)</h3>
                    <div class="file-upload-area" id="classesUploadArea"
                        onclick="document.getElementById('classesFile').click()">
                        <div class="upload-icon"><i class="fas fa-file-csv"></i></div>
                        <p><strong>Click to upload or drag & drop</strong></p>
                        <p class="upload-hint">CSV file only</p>
                        <input type="file" id="classesFile" accept=".csv" style="display:none;"
                            onchange="handleClassesUpload(event)">
                    </div>
                    <div class="import-progress" id="classesProgress" style="display: none;">
                        <div>Importing classes...</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="classesProgressBar" style="width: 0%">0%</div>
                        </div>
                    </div>

                    <!-- Complete Database Import -->
                    <div class="complete-import-section">
                        <h3><i class="fas fa-database"></i> Complete Database Import (ZIP/JSON)</h3>
                        <div class="alert alert-info">
                            <i class="fas fa-exclamation-triangle"></i> Import a complete database backup ZIP file or
                            JSON file. This will restore all data including attendance records.
                            <strong>Warning:</strong> This will replace existing data.
                        </div>

                        <div class="file-upload-area" id="completeDbUploadArea"
                            onclick="document.getElementById('completeDbFile').click()">
                            <div class="upload-icon"><i class="fas fa-file-archive"></i></div>
                            <p><strong>Click to upload complete database backup</strong></p>
                            <p class="upload-hint">ZIP file or JSON backup</p>
                            <input type="file" id="completeDbFile" accept=".zip,.json,.ZIP,.JSON" style="display:none;"
                                onchange="handleCompleteDbUpload(event)">
                        </div>

                        <div class="import-progress" id="completeDbProgress" style="display: none;">
                            <div>Importing complete database...</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="completeDbProgressBar" style="width: 0%">0%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attendance History Tab -->
                <div id="adminAttendanceHistory" class="tab-content">
                    <h2 class="section-title"><i class="fas fa-history"></i> Attendance History Reports</h2>

                    <div class="filter-container">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="adminYearFilter">Select Year:</label>
                                <select id="adminYearFilter">
                                    <option value="all">All Years</option>
                                    <option value="1">1st Year</option>
                                    <option value="2">2nd Year</option>
                                    <option value="3">3rd Year</option>
                                    <option value="4">4th Year</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="adminBranchFilter">Select Branch:</label>
                                <select id="adminBranchFilter">
                                    <option value="all">All Branches</option>
                                    <option value="Computer Science">Computer Science</option>
                                    <option value="Civil">Civil</option>
                                    <option value="Mechanical">Mechanical</option>
                                    <option value="Electrical">Electrical</option>
                                    <option value="ECE">ECE</option>
                                    <option value="CSE(Cyber Security)">CSE(Cyber Security)</option>
                                    <option value="CSE(Networks)">CSE(Networks)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="adminSemesterFilter">Select Semester:</label>
                                <select id="adminSemesterFilter">
                                    <option value="all">All Semesters</option>
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                    <option value="5">Semester 5</option>
                                    <option value="6">Semester 6</option>
                                    <option value="7">Semester 7</option>
                                    <option value="8">Semester 8</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="adminClassFilter">Select Class:</label>
                                <select id="adminClassFilter">
                                    <option value="all">All Classes</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Date Filter:</label>
                                <div class="radio-group">
                                    <label>
                                        <input type="radio" name="dateFilterType" value="all" checked
                                            onchange="toggleDateRange()">
                                        <span>All Records</span>
                                    </label>
                                    <label>
                                        <input type="radio" name="dateFilterType" value="range"
                                            onchange="toggleDateRange()">
                                        <span>Date Range</span>
                                    </label>
                                </div>
                                <div id="dateRangeInputs" class="date-range-inputs" style="display: none;">
                                    <input type="date" id="adminDateFrom">
                                    <span class="range-separator">to</span>
                                    <input type="date" id="adminDateTo">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="adminStatusFilter">Status Filter:</label>
                                <select id="adminStatusFilter">
                                    <option value="all">All Status</option>
                                    <option value="present">Present Only</option>
                                    <option value="absent">Absent Only</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="adminSortBy">Sort By:</label>
                                <select id="adminSortBy">
                                    <option value="percentage_desc">Percentage (High to Low)</option>
                                    <option value="percentage_asc">Percentage (Low to High)</option>
                                    <option value="rollno_asc">Roll No (Ascending)</option>
                                    <option value="rollno_desc">Roll No (Descending)</option>
                                    <option value="name_asc">Name (A-Z)</option>
                                    <option value="name_desc">Name (Z-A)</option>
                                </select>
                            </div>

                            <div class="form-group action-buttons">
                                <label>&nbsp;</label>
                                <button class="btn btn-primary" onclick="loadAdminAttendanceHistory()">
                                    <i class="fas fa-chart-bar"></i> Load Attendance
                                </button>
                                <button class="btn btn-info" onclick="loadAdminAttendanceHistory()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                                <button class="btn btn-secondary" onclick="clearAdminFilters()">
                                    <i class="fas fa-broom"></i> Clear Filters
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="table-header">
                        <h3>Attendance Records <span id="adminRecordCount" class="count-badge">(0)</span></h3>
                        <div class="export-buttons">
                            <button class="btn btn-success" onclick="exportAdminHistory('csv')">
                                <i class="fas fa-file-csv"></i> Export CSV
                            </button>
                            <button class="btn btn-primary" onclick="exportAdminHistory('excel')">
                                <i class="fas fa-file-excel"></i> Export Excel
                            </button>
                            <button class="btn btn-danger" onclick="exportAdminHistory('json')">
                                <i class="fas fa-file-code"></i> Export JSON
                            </button>
                        </div>
                    </div>

                    <!-- Year-wise Attendance Summary Section -->
                    <div id="yearWiseAttendanceSection" class="summary-section" style="display: none;">
                        <h3><i class="fas fa-chart-line"></i> Year-wise Attendance Summary</h3>
                        <div id="yearWiseAttendanceSummary">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>

                    <div class="table-responsive" id="adminAttendanceTableContainer">
                        <table id="adminAttendanceTable">
                            <thead>
                                <tr>
                                    <th>Roll No</th>
                                    <th>Student Name</th>
                                    <th>Department</th>
                                    <th>Year</th>
                                    <th>Semester</th>
                                    <th>Class</th>
                                    <th>Total Classes</th>
                                    <th>Present</th>
                                    <th>Absent</th>
                                    <th>Attendance %</th>
                                </tr>
                            </thead>
                            <tbody id="adminAttendanceBody">
                                <tr id="noAttendanceRow">
                                    <td colspan="10" class="no-data">No attendance records found. Apply filters to load
                                        data.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="adminAttendanceStats" class="stats-section" style="display: none;">
                        <h4><i class="fas fa-chart-bar"></i> Statistics</h4>
                        <div class="dashboard-grid">
                            <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #229954);">
                                <h3>Total Students</h3>
                                <div class="value" id="statTotalRecords">0</div>
                            </div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                                <h3>Average Attendance %</h3>
                                <div class="value" id="statAvgPercentage">0%</div>
                            </div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #f39c12, #d68910);">
                                <h3>Above 75%</h3>
                                <div class="value" id="statAbove75">0</div>
                            </div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                                <h3>Below 75%</h3>
                                <div class="value" id="statBelow75">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bulk Export Tab -->
                <div id="adminBulkExport" class="tab-content">
                    <h2 class="section-title"><i class="fas fa-file-export"></i> Bulk Export</h2>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Export complete datasets in CSV format. Data is grouped by
                        year where applicable.
                    </div>

                    <!-- Export Cards -->
                    <div class="dashboard-grid export-grid">
                        <div class="stat-card export-card" onclick="exportBulkData('students')" tabindex="0"
                            role="button">
                            <div class="export-card-inner">
                                <div class="export-icon"><i class="fas fa-users"></i></div>
                                <h3 class="export-title">Export Students</h3>
                                <p class="export-desc">
                                    Year-wise grouping<br>
                                    All student details included
                                </p>
                            </div>
                        </div>

                        <div class="stat-card export-card" onclick="exportBulkData('classes')" tabindex="0"
                            role="button">
                            <div class="export-card-inner">
                                <div class="export-icon"><i class="fas fa-school"></i></div>
                                <h3 class="export-title">Export Classes</h3>
                                <p class="export-desc">
                                    Year-wise grouping<br>
                                    All class details included
                                </p>
                            </div>
                        </div>

                        <div class="stat-card export-card" onclick="exportBulkData('faculty')" tabindex="0"
                            role="button">
                            <div class="export-card-inner">
                                <div class="export-icon"><i class="fas fa-chalkboard-teacher"></i></div>
                                <h3 class="export-title">Export Faculty</h3>
                                <p class="export-desc">
                                    Complete faculty list<br>
                                    All details included
                                </p>
                            </div>
                        </div>

                        <div class="stat-card export-card" onclick="exportAllInOne()" tabindex="0" role="button">
                            <div class="export-card-inner">
                                <div class="export-icon"><i class="fas fa-file-archive"></i></div>
                                <h3 class="export-title">Export All Data</h3>
                                <p class="export-desc">
                                    Students + Classes + Faculty<br>
                                    Multiple CSV files
                                </p>
                            </div>
                        </div>

                        <div class="stat-card export-card" onclick="exportCompleteDatabase()" tabindex="0"
                            role="button">
                            <div class="export-card-inner">
                                <div class="export-icon"><i class="fas fa-database"></i></div>
                                <h3 class="export-title">Complete Database Export</h3>
                                <p class="export-desc">
                                    EVERYTHING in one ZIP<br>
                                    Including attendance history
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics -->
                    <div class="export-stats">
                        <h3><i class="fas fa-chart-bar"></i> Export Statistics</h3>

                        <div class="stats-grid">
                            <div class="stat-item">
                                <h4>Students</h4>
                                <div id="exportStudentCount" class="stat-number">0</div>
                                <p>Total students available for export</p>
                            </div>

                            <div class="stat-item">
                                <h4>Faculty</h4>
                                <div id="exportFacultyCount" class="stat-number">0</div>
                                <p>Total faculty available for export</p>
                            </div>

                            <div class="stat-item">
                                <h4>Classes</h4>
                                <div id="exportClassCount" class="stat-number">0</div>
                                <p>Total classes available for export</p>
                            </div>
                        </div>
                    </div>

                    <!-- Info -->
                    <div class="export-info">
                        <h3><i class="fas fa-info-circle"></i> Export Information</h3>
                        <ul>
                            <li>All exports are in CSV format (compatible with Excel)</li>
                            <li>Students are grouped by academic year</li>
                            <li>Classes are grouped by academic year</li>
                            <li>Faculty export includes all details including specialization</li>
                            <li>Use <strong>Export All Data</strong> to get everything in one go</li>
                            <li><strong>Complete Database Export</strong> includes attendance records and settings</li>
                        </ul>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="adminSettings" class="tab-content">
                    <h2 class="section-title"><i class="fas fa-cog"></i> Settings</h2>
                    <form onsubmit="saveSettings(event); return false;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="collegeName">College Name:</label>
                                <input type="text" id="collegeName" value="Engineering College">
                            </div>
                            <div class="form-group">
                                <label for="minAttendance">Min Attendance (%):</label>
                                <input type="number" id="minAttendance" value="75" min="0" max="100">
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Save
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="exportAllData()">
                                <i class="fas fa-download"></i> Export All Data
                            </button>
                            <button type="button" class="btn btn-danger" onclick="confirmClearAllStudents()">
                                <i class="fas fa-trash"></i> Clear All Students
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- FACULTY PANEL -->
        <div id="facultyPanel" class="panel" style="display: none;">
            <div class="section">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchFacultyTab('mark', event)"><i
                            class="fas fa-check-circle"></i> Mark Attendance</button>
                    <button class="tab-btn" onclick="switchFacultyTab('history', event)"><i class="fas fa-history"></i>
                        Date-wise History</button>
                    <button class="tab-btn" onclick="switchFacultyTab('report', event)"><i class="fas fa-chart-bar"></i>
                        Report</button>
                </div>

                <!-- Mark Attendance Tab -->
                <div id="facultyMark" class="tab-content active">
                    <h2 class="section-title"><i class="fas fa-check-circle"></i> Mark Attendance (Multi-Session
                        Support)</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="facultyClassSelect">Select Class:</label>
                            <select id="facultyClassSelect" onchange="loadClassStudents()">
                                <option value="">-- Select a class --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attendanceDate">Date:</label>
                            <input type="date" id="attendanceDate">
                        </div>
                        <div class="form-group">
                            <label for="attendanceSession">Session:</label>
                            <select id="attendanceSession">
                                <option value="1">Session 1</option>
                                <option value="2">Session 2</option>
                                <option value="3">Session 3</option>
                                <option value="4">Session 4</option>
                                <option value="5">Session 5</option>
                            </select>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="openBulkAttendanceModal()">
                            <i class="fas fa-upload"></i> Bulk Upload
                        </button>
                        <button class="btn btn-info" onclick="downloadAttendanceReport()">
                            <i class="fas fa-download"></i> Download Report (CSV)
                        </button>
                        <button class="btn btn-warning" id="multiSessionBtn" style="display:none;">
                            <i class="fas fa-calendar-alt"></i> Mark Multiple Sessions
                        </button>
                    </div>

                    <!-- Add Student/Batch to Session Logic -->
                    <div class="extra-students-section">
                        <h4><i class="fas fa-user-plus"></i> Add Extra Students (Electives/Backlogs)</h4>

                        <div class="add-single-student">
                            <input type="text" id="addStudentToSessionInput"
                                placeholder="Enter Roll No (e.g. 22156...)">
                            <button class="btn btn-info" onclick="addStudentToSession()">
                                <i class="fas fa-plus"></i> Add Single Student
                            </button>
                        </div>

                        <div class="add-batch-section">
                            <select id="addBatchBranch">
                                <option value="">-- Select Branch --</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Civil">Civil</option>
                                <option value="Mechanical">Mechanical</option>
                                <option value="Electrical">Electrical</option>
                                <option value="ECE">ECE</option>
                                <option value="CSE(Cyber Security)">CSE(Cyber Security)</option>
                                <option value="CSE(Networks)">CSE(Networks)</option>
                                <option value="Applied Science">Applied Science</option>
                            </select>
                            <select id="addBatchSem">
                                <option value="">-- Sem --</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                            </select>
                            <button class="btn btn-warning" onclick="addBatchToSession()">
                                <i class="fas fa-users"></i> Add Whole Batch
                            </button>
                        </div>
                    </div>

                    <div id="studentGridContainer" style="display:none;">
                        <div id="studentGrid" class="student-grid"></div>
                        <div class="action-buttons">
                            <button class="btn btn-success" onclick="submitAttendance()">
                                <i class="fas fa-check"></i> Submit Attendance for Session <span
                                    id="currentSessionDisplay">1</span>
                            </button>
                            <button class="btn btn-secondary" onclick="resetAttendance()">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Date-wise History Tab -->
                <div id="facultyHistory" class="tab-content">
                    <h2 class="section-title"><i class="fas fa-history"></i> Attendance History (Multi-Session)</h2>
                    <div class="table-header">
                        <p class="description">Select a date to view or edit attendance for the selected class.</p>
                        <button class="btn btn-success" onclick="downloadHistoryCSV()">
                            <i class="fas fa-download"></i> Download History (CSV)
                        </button>
                        <button class="btn btn-info" onclick="downloadSubjectAttendanceReport()">
                            <i class="fas fa-file-chart-line"></i> Download Subject Attendance Report
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="historyClassSelect">Select Class:</label>
                            <select id="historyClassSelect" onchange="loadAttendanceHistory()">
                                <option value="">-- Select a class --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="historyDateFilter">Filter Date (Optional):</label>
                            <input type="date" id="historyDateFilter" onchange="loadAttendanceHistory()">
                        </div>
                    </div>

                    <div id="historyList" class="history-list"></div>
                </div>

                <!-- Report Tab -->
                <div id="facultyReport" class="tab-content">
                    <h2 class="section-title"><i class="fas fa-chart-bar"></i> Year-wise Attendance Report</h2>
                    <div class="year-filter" id="yearFilter"></div>
                    <div class="table-responsive">
                        <table id="yearWiseAttendanceTable">
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>Classes Held (Records)</th>
                                    <th>Total Attended</th>
                                    <th>Absent</th>
                                    <th>Attendance %</th>
                                </tr>
                            </thead>
                            <tbody id="yearWiseAttendanceBody">
                                <tr id="noReportData">
                                    <td colspan="5" class="no-data">No attendance data available. Mark some attendance
                                        first.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- STUDENT PANEL -->
        <div id="studentPanel" class="panel" style="display: none;">
            <div class="section">
                <h2 class="section-title"><i class="fas fa-user-graduate"></i> Student Profile</h2>
                <div class="profile-card">
                    <div class="profile-info">
                        <h3 id="studentNameDisplay">Student Name</h3>
                        <p id="studentRollDisplay" class="roll-no">Roll No: -</p>
                    </div>
                    <div class="profile-details">
                        <p><strong><i class="fas fa-envelope"></i> Email:</strong> <span
                                id="studentEmailDisplay">-</span></p>
                        <p><strong><i class="fas fa-university"></i> Department:</strong> <span
                                id="studentDeptDisplay">-</span></p>
                        <p><strong><i class="fas fa-calendar"></i> Semester:</strong> <span
                                id="studentSemDisplay">-</span></p>
                        <p><strong><i class="fas fa-calendar-alt"></i> Year:</strong> <span
                                id="studentYearDisplay">-</span></p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title"><i class="fas fa-clipboard-list"></i> My Attendance</h2>
                <div class="table-responsive">
                    <table id="studentAttendanceTable">
                        <thead>
                            <tr>
                                <th>Course</th>
                                <th>Faculty</th>
                                <th>Total Classes (Sessions)</th>
                                <th>Attended</th>
                                <th>Percentage</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="studentAttendanceBody">
                            <tr id="noStudentAttendance">
                                <td colspan="6" class="no-data">No attendance records found yet.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ================ MODALS ================ -->

    <!-- Faculty Profile Modal -->
    <div id="facultyProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-chalkboard-teacher"></i> Faculty Profile
                <button class="close-btn" onclick="closeModal('facultyProfileModal')">&times;</button>
            </div>
            <div id="facultyProfileContent"></div>
            <div class="modal-footer">
                <button class="btn btn-info" id="btnEditFacultyClasses">
                    <i class="fas fa-edit"></i> Edit Profile & Classes
                </button>
                <button class="btn btn-secondary" onclick="closeModal('facultyProfileModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-user-plus"></i> Add Student
                <button class="close-btn" onclick="closeModal('addUserModal')">&times;</button>
            </div>
            <form onsubmit="addStudent(event); return false;">
                <div class="form-group">
                    <label for="studentRollNo">Roll No:</label>
                    <input type="text" id="studentRollNo" oninput="autoFillStudentDetails()" required>
                    <small class="input-hint">Enter Roll No (e.g. 22156...) to auto-fill details</small>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="studentFirstName">First Name:</label>
                        <input type="text" id="studentFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="studentLastName">Last Name:</label>
                        <input type="text" id="studentLastName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="studentEmail">Email:</label>
                    <input type="email" id="studentEmail" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="studentDept">Department:</label>
                        <select id="studentDept" required>
                            <option value="">-- Select --</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Civil">Civil</option>
                            <option value="Mechanical">Mechanical</option>
                            <option value="Electrical">Electrical</option>
                            <option value="ECE">ECE</option>
                            <option value="CSE(Cyber Security)">CSE(Cyber Security)</option>
                            <option value="CSE(Networks)">CSE(Networks)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="studentYear">Year:</label>
                        <input type="number" id="studentYear" min="1" max="4" required>
                    </div>
                    <div class="form-group">
                        <label for="studentSemester">Semester:</label>
                        <select id="studentSemester" required>
                            <option value="">-- Select --</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-plus"></i> Add Student
                </button>
            </form>
        </div>
    </div>

    <!-- Add Faculty Modal -->
    <div id="addFacultyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-user-plus"></i> Add Faculty
                <button class="close-btn" onclick="closeModal('addFacultyModal')">&times;</button>
            </div>
            <form onsubmit="addFaculty(event); return false;">
                <div class="form-group">
                    <label for="facultyId">Faculty ID:</label>
                    <input type="text" id="facultyId" required>
                </div>
                <div class="form-group">
                    <label for="facultyPassword">Password:</label>
                    <input type="password" id="facultyPassword" placeholder="Set login password" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="facultyFirstName">First Name:</label>
                        <input type="text" id="facultyFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="facultyLastName">Last Name:</label>
                        <input type="text" id="facultyLastName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="facultyEmail" class="optional-label">Email</label>
                    <input type="email" id="facultyEmail" placeholder="Optional field">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="facultyDept">Department:</label>
                        <select id="facultyDept" required>
                            <option value="">-- Select --</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Civil">Civil</option>
                            <option value="Mechanical">Mechanical</option>
                            <option value="Electrical">Electrical</option>
                            <option value="ECE">ECE</option>
                            <option value="CSE(Cyber Security)">CSE(Cyber Security)</option>
                            <option value="CSE(Networks)">CSE(Networks)</option>
                            <option value="Applied Science">Applied Science</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="facultySpecial" class="optional-label">Specialization</label>
                        <input type="text" id="facultySpecial" placeholder="Optional field">
                    </div>
                </div>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-plus"></i> Add Faculty
                </button>
            </form>
        </div>
    </div>

    <!-- Edit Faculty Modal -->
    <div id="editFacultyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-edit"></i> Edit Faculty
                <button class="close-btn" onclick="closeModal('editFacultyModal')">&times;</button>
            </div>
            <form onsubmit="updateFaculty(event); return false;">
                <input type="hidden" id="editFacultyIdKey">
                <div class="form-group">
                    <label for="editFacultyId">Faculty ID:</label>
                    <input type="text" id="editFacultyId" required>
                </div>
                <div class="form-group">
                    <label for="editFacultyPassword">Password (Leave blank to keep current):</label>
                    <input type="password" id="editFacultyPassword" placeholder="Enter new password to change">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editFacultyFirstName">First Name:</label>
                        <input type="text" id="editFacultyFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="editFacultyLastName">Last Name:</label>
                        <input type="text" id="editFacultyLastName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editFacultyEmail">Email:</label>
                    <input type="email" id="editFacultyEmail">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editFacultyDept">Department:</label>
                        <select id="editFacultyDept" required>
                            <option value="">-- Select --</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Civil">Civil</option>
                            <option value="Mechanical">Mechanical</option>
                            <option value="Electrical">Electrical</option>
                            <option value="ECE">ECE</option>
                            <option value="CSE(Cyber Security)">CSE(Cyber Security)</option>
                            <option value="CSE(Networks)">CSE(Networks)</option>
                            <option value="Applied Science">Applied Science</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editFacultySpecial">Specialization:</label>
                        <input type="text" id="editFacultySpecial">
                    </div>
                </div>

                <h4 class="modal-subtitle"><i class="fas fa-school"></i> Assign Classes</h4>
                <p class="modal-description">Select classes to assign to this faculty member.</p>
                <div class="class-assignment-grid" id="editFacultyClassesList"></div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Update Faculty
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Class Modal -->
    <div id="addClassModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-plus"></i> Add Class
                <button class="close-btn" onclick="closeModal('addClassModal')">&times;</button>
            </div>
            <form onsubmit="addClass(event); return false;">
                <div class="form-group">
                    <label for="classCode">Class Code:</label>
                    <input type="text" id="classCode" required>
                </div>
                <div class="form-group">
                    <label for="courseName">Course Name:</label>
                    <input type="text" id="courseName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="classDept">Department:</label>
                        <select id="classDept" required>
                            <option value="">-- Select --</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Civil">Civil</option>
                            <option value="Mechanical">Mechanical</option>
                            <option value="Electrical">Electrical</option>
                            <option value="ECE">ECE</option>
                            <option value="CSE(Cyber Security)">CSE(Cyber Security)</option>
                            <option value="CSE(Networks)">CSE(Networks)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="classSemester">Semester:</label>
                        <input type="number" id="classSemester" min="1" max="8" required>
                    </div>
                    <div class="form-group">
                        <label for="classYear">Year:</label>
                        <input type="number" id="classYear" min="1" max="4" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="classFaculty">Faculty:</label>
                        <select id="classFaculty" required></select>
                    </div>
                    <div class="form-group">
                        <label for="classCredits">Credits:</label>
                        <input type="number" id="classCredits" value="3" min="1" max="10">
                    </div>
                </div>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-plus"></i> Add Class
                </button>
            </form>
        </div>
    </div>

    <!-- Edit Class Modal -->
    <div id="editClassModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-edit"></i> Edit Class
                <button class="close-btn" onclick="closeModal('editClassModal')">&times;</button>
            </div>
            <form onsubmit="updateClass(event); return false;">
                <input type="hidden" id="editClassIdKey">
                <div class="form-group">
                    <label for="editClassCode">Class Code:</label>
                    <input type="text" id="editClassCode" required>
                </div>
                <div class="form-group">
                    <label for="editCourseName">Course Name:</label>
                    <input type="text" id="editCourseName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editClassDept">Department:</label>
                        <select id="editClassDept" required>
                            <option value="">-- Select --</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Civil">Civil</option>
                            <option value="Mechanical">Mechanical</option>
                            <option value="Electrical">Electrical</option>
                            <option value="ECE">ECE</option>
                            <option value="CSE(Cyber Security)">CSE(Cyber Security)</option>
                            <option value="CSE(Networks)">CSE(Networks)</option>
                            <option value="Applied Science">Applied Science</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editClassSemester">Semester:</label>
                        <input type="number" id="editClassSemester" min="1" max="8" required>
                    </div>
                    <div class="form-group">
                        <label for="editClassYear">Year:</label>
                        <input type="number" id="editClassYear" min="1" max="4" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editClassFaculty">Faculty:</label>
                        <select id="editClassFaculty" required></select>
                    </div>
                    <div class="form-group">
                        <label for="editClassCredits">Credits:</label>
                        <input type="number" id="editClassCredits" value="3" min="1" max="10">
                    </div>
                </div>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Update Class
                </button>
            </form>
        </div>
    </div>

    <!-- Batch Class Creator Modal -->
    <div id="batchClassModal" class="modal">
        <div class="modal-content wide-modal">
            <div class="modal-header">
                <i class="fas fa-folder-plus"></i> Batch Class Creator
                <button class="close-btn" onclick="closeModal('batchClassModal')">&times;</button>
            </div>
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> Paste your class list in the format: <strong>Semester, Subject Name,
                    Subject Code, Faculty Name</strong>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="batchBranch">Branch / Department (Applied to all):</label>
                    <select id="batchBranch" required>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Civil">Civil</option>
                        <option value="Mechanical">Mechanical</option>
                        <option value="Electrical">Electrical</option>
                        <option value="ECE">ECE</option>
                        <option value="CSE(Cyber Security)">CSE(Cyber Security)</option>
                        <option value="CSE(Networks)">CSE(Networks)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="batchYear">Year (Applied to all):</label>
                    <input type="number" id="batchYear" value="2024" min="2000" max="2100">
                </div>
            </div>

            <div class="form-group">
                <label for="batchClassInput">Paste Data (Each line is a new subject):</label>
                <textarea id="batchClassInput" rows="6" placeholder="Example:
1, Mathematics-I, MAT101, Dr. Smith
1, Physics, PHY101, Prof. Doe"></textarea>
            </div>

            <button class="btn btn-primary" onclick="previewBatchClasses()">
                <i class="fas fa-search"></i> Parse & Preview
            </button>

            <div id="batchPreviewArea" style="display:none;">
                <h3>Preview</h3>
                <div class="table-responsive">
                    <table id="batchPreviewTable">
                        <thead>
                            <tr>
                                <th>Sem</th>
                                <th>Subject</th>
                                <th>Code</th>
                                <th>Faculty</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" onclick="saveBatchClasses()">
                        <i class="fas fa-save"></i> Save All Classes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Attendance Modal -->
    <div id="bulkAttendanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-upload"></i> Bulk Upload Attendance (Multi-Session)
                <button class="close-btn" onclick="closeModal('bulkAttendanceModal')">&times;</button>
            </div>
            <div class="alert alert-info">
                Paste student Roll Numbers for the selected class. <br>
                Format: <strong>RollNo</strong> (Default: Present) or <strong>RollNo, Status (P/A)</strong><br>
                <strong>Note:</strong> This will be saved for the currently selected session.
            </div>

            <div class="form-group">
                <label for="bulkAttendanceSession">Session (for this bulk upload):</label>
                <select id="bulkAttendanceSession">
                    <option value="1">Session 1</option>
                    <option value="2">Session 2</option>
                    <option value="3">Session 3</option>
                    <option value="4">Session 4</option>
                    <option value="5">Session 5</option>
                </select>
            </div>

            <div class="form-group">
                <label for="bulkAttendanceInput">Attendance Data:</label>
                <textarea id="bulkAttendanceInput" rows="10" placeholder="22156148040, P
22156148041, A
..."></textarea>
            </div>
            <button class="btn btn-success" onclick="saveBulkAttendance()">
                <i class="fas fa-upload"></i> Upload & Save for Selected Session
            </button>
        </div>
    </div>

    <!-- Student Attendance Detail Modal -->
    <div id="studentAttendanceDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-clipboard-list"></i> Student Attendance Details
                <button class="close-btn" onclick="closeModal('studentAttendanceDetailModal')"></button>
            </div>
            <div style="padding: 20px;">
                <h3 id="detailStudentName">Name</h3>
                <p><strong><i class="fas fa-id-card"></i> Roll No:</strong> <span id="detailStudentRoll">-</span></p>
                <p><strong><i class="fas fa-university"></i> Department:</strong> <span id="detailStudentDept">-</span>
                </p>
                <p><strong><i class="fas fa-calendar"></i> Semester:</strong> <span id="detailStudentSem">-</span></p>
                <hr>
                <h4><i class="fas fa-history"></i> Attendance Records</h4>
                <div id="detailAttendanceList" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <!-- Add Year Modal -->
    <div id="addYearModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-plus"></i> Add Academic Year
                <button class="close-btn" onclick="closeModal('addYearModal')">&times;</button>
            </div>
            <form onsubmit="addAcademicYear(event); return false;">
                <div class="form-group">
                    <label for="academicYear">Year (e.g., 2024):</label>
                    <input type="number" id="academicYear" placeholder="2024" min="2000" max="2100" required>
                </div>
                <div class="form-group">
                    <label for="yearStartDate">Start Date:</label>
                    <input type="date" id="yearStartDate" required>
                </div>
                <div class="form-group">
                    <label for="yearEndDate">End Date:</label>
                    <input type="date" id="yearEndDate" required>
                </div>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-plus"></i> Add Year
                </button>
            </form>
        </div>
    </div>

    <!-- Edit Attendance Modal -->
    <div id="editAttendanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-edit"></i> Edit Attendance Record
                <button class="close-btn" onclick="closeModal('editAttendanceModal')">&times;</button>
            </div>
            <form onsubmit="saveEditedAttendance(event); return false;">
                <input type="hidden" id="editAttendanceId">
                <input type="hidden" id="editAttendanceStudentId">

                <div class="profile-info-grid">
                    <div class="profile-info-item">
                        <label>Student</label>
                        <div id="editStudentInfo">-</div>
                    </div>
                    <div class="profile-info-item">
                        <label>Class</label>
                        <div id="editClassInfo">-</div>
                    </div>
                    <div class="profile-info-item">
                        <label>Date & Session</label>
                        <div id="editDateInfo">-</div>
                    </div>
                    <div class="profile-info-item">
                        <label>Faculty</label>
                        <div id="editFacultyInfo">-</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="editSessionSelector">Session:</label>
                    <select id="editSessionSelector">
                        <option value="1">Session 1</option>
                        <option value="2">Session 2</option>
                        <option value="3">Session 3</option>
                        <option value="4">Session 4</option>
                        <option value="5">Session 5</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Attendance Status:</label>
                    <div class="status-radio-group">
                        <label>
                            <input type="radio" name="attendanceStatus" value="present" checked>
                            <span class="status-badge present">Present</span>
                        </label>
                        <label>
                            <input type="radio" name="attendanceStatus" value="absent">
                            <span class="status-badge absent">Absent</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="editAttendanceNotes" class="optional-label">Notes (Optional)</label>
                    <textarea id="editAttendanceNotes" rows="3"
                        placeholder="Add any notes about this attendance record..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="deleteAttendanceRecord()">
                        <i class="fas fa-trash"></i> Delete Record
                    </button>
                    <div>
                        <button type="button" class="btn btn-secondary"
                            onclick="closeModal('editAttendanceModal')">Cancel</button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Generic Confirmation Modal -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <i class="fas fa-question-circle"></i> Confirm Action
                <button class="close-btn" onclick="closeModal('confirmationModal')">&times;</button>
            </div>
            <p id="confirmationMessage">Are you sure?</p>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('confirmationModal')">Cancel</button>
                <button class="btn btn-danger" id="confirmActionBtn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div id="passwordChangeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-key"></i> Change Password
                <button class="close-btn" onclick="closeModal('passwordChangeModal')">&times;</button>
            </div>
            <form onsubmit="handlePasswordChange(event); return false;">
                <div class="form-group">
                    <label for="currentPassword">Current Password:</label>
                    <input type="password" id="currentPassword" required autocomplete="current-password">
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password:</label>
                    <input type="password" id="newPassword" required minlength="6" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password:</label>
                    <input type="password" id="confirmPassword" required minlength="6" autocomplete="new-password">
                </div>
                <div class="alert alert-error" id="passwordChangeError" style="display:none;"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                        onclick="closeModal('passwordChangeModal')">Cancel</button>
                    <button type="submit" class="btn btn-success">Change Password</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Faculty Password Reset Modal (Admin Only) -->
    <div id="facultyPasswordResetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-key"></i> Reset Faculty Password
                <button class="close-btn" onclick="closeModal('facultyPasswordResetModal')">&times;</button>
            </div>
            <div class="form-group">
                <label for="resetFacultySelect">Select Faculty:</label>
                <select id="resetFacultySelect">
                    <option value="">-- Select Faculty --</option>
                </select>
            </div>
            <div class="form-group">
                <label for="resetFacultyPassword">New Password:</label>
                <input type="text" id="resetFacultyPassword" value="password123">
                <small class="input-hint">Default password: password123</small>
            </div>
            <div class="alert alert-info" id="resetFacultyInfo" style="display: none;"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary"
                    onclick="closeModal('facultyPasswordResetModal')">Cancel</button>
                <button type="button" class="btn btn-success" onclick="resetFacultyPassword()">Reset Password</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- ================ EXTERNAL JAVASCRIPT FILES ================ -->
    <script src="config.js"></script>
    <script src="database.js"></script>
    <script src="auth.js"></script>
    <script src="ui.js"></script>
    <script src="attendance.js"></script>
    <script src="utils.js"></script>
    <script src="main.js"></script>

    <!-- Initialize app when DOM is loaded -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Advanced Attendance System Loaded');

            // Set today's date in date inputs
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                if (!input.id.includes('From') && !input.id.includes('To') && !input.value) {
                    input.value = today;
                }
            });

            // Set minimum date to today for future dates
            const futureDateInputs = document.querySelectorAll('#attendanceDate, #attendanceDateFilter');
            futureDateInputs.forEach(input => {
                input.min = today;
            });

            // Initialize the application
            if (typeof initApp === 'function') {
                initApp();
            }
        });
    </script>
</body>

</html>
